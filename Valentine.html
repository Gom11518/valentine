<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>I Love You - Valentine 3D</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Parisienne&family=Sarabun:wght@300&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; background: #050205; color: #ffccff; font-family: 'Sarabun', sans-serif; }
    canvas { position: fixed; top: 0; left: 0; outline: none; }
    .content-overlay { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 12vh 2rem; z-index: 10; pointer-events: none; }
    h1 { font-family: 'Parisienne', cursive; font-size: clamp(3.5rem, 10vw, 6rem); text-shadow: 0 0 25px rgba(255, 102, 204, 0.9); animation: glow 2s ease-in-out infinite alternate; }
    .dedication { text-align: center; background: rgba(255, 192, 203, 0.1); padding: 1.2rem 2.5rem; border-radius: 50px; backdrop-filter: blur(8px); border: 1px solid rgba(255, 192, 203, 0.3); }
    @keyframes glow { from { text-shadow: 0 0 20px rgba(255, 102, 204, 0.8); } to { text-shadow: 0 0 35px rgba(255, 102, 204, 1), 0 0 10px #fff; } }
  </style>
</head>
<body>
  <canvas class="webgl"></canvas>
  <div class="content-overlay">
    <h1>I Love You</h1>
    <div class="dedication">
      <p>ขอบคุณที่เป็นความสุขให้กันเสมอมานะครับ</p>
      <p style="font-size: 0.9rem; margin-top: 5px; color: #ff99cc;">รักนะจุ๊บๆ ❤️</p>
    </div>
  </div>

  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.135.0';
    import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.135.0/examples/jsm/loaders/GLTFLoader';

    class ValentineWorld {
      constructor() {
        this.canvas = document.querySelector('.webgl');
        this.scene = new THREE.Scene();
        this.textureLoader = new THREE.TextureLoader();
        this.clock = new THREE.Clock();
        this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        this.camera.position.z = 5;
        this.renderer = new THREE.WebGLRenderer({ canvas: this.canvas, antialias: true });
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        this.photoGroup = new THREE.Group();
        this.scene.add(this.photoGroup);
        this.init();
      }

      async init() {
        this.addMovingStars();
        this.addPhotoRing();
        await this.loadMainHeart(); 
        this.animate();
        window.addEventListener('resize', () => this.onResize());
      }

      addMovingStars() {
        const geo = new THREE.BufferGeometry();
        const count = 4000;
        const pos = new Float32Array(count * 3);
        const velocities = new Float32Array(count);
        for(let i=0; i<count*3; i++) pos[i] = (Math.random() - 0.5) * 25;
        for(let i=0; i<count; i++) velocities[i] = Math.random() * 0.03 + 0.01;
        geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        this.starVelocities = velocities;
        this.starGeo = geo;
        const mat = new THREE.PointsMaterial({ size: 0.03, color: 0xffccff, transparent: true, opacity: 0.8 });
        this.stars = new THREE.Points(geo, mat);
        this.scene.add(this.stars);
      }

      addPhotoRing() {
        // ชื่อไฟล์ต้องตรงกับในโฟลเดอร์เป๊ะๆ (Tong ตัวใหญ่)
        const photos = [
          'Tong1.jpg', 'Tong2.jpg', 'Tong3.jpg', 'Tong4.jpg', 
          'Tong5.jpg', 'Tong6.jpg', 'Tong7.jpg', 'Tong8.jpg', 
          'Tong9.jpg', 'Tong10.jpg', 'Tong11.jpg'
        ];
        
        const radius = 3.2;
        photos.forEach((url, i) => {
          // โหลดรูปภาพโดยตรง (เพราะไฟล์อยู่ทีเดียวกันแล้ว)
          this.textureLoader.load(url, (tex) => {
            const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });
            const mesh = new THREE.Mesh(new THREE.PlaneGeometry(0.9, 0.9), mat);
            const angle = (i / photos.length) * Math.PI * 2;
            mesh.position.set(Math.cos(angle) * radius, (Math.random()-0.5), Math.sin(angle) * radius);
            mesh.lookAt(0, 0, 0);
            this.photoGroup.add(mesh);
          }, undefined, (err) => {
            console.error("โหลดรูปไม่ได้ครับ: " + url);
          });
        });
      }

      async loadMainHeart() {
        const loader = new GLTFLoader();
        loader.load('https://assets.codepen.io/74321/heart.glb', (gltf) => {
          this.heart = gltf.scene;
          this.heart.scale.set(0.3, 0.3, 0.3);
          this.heart.traverse(n => { if(n.isMesh) n.material = new THREE.MeshBasicMaterial({ color: 0xff3366, wireframe: true }); });
          this.scene.add(this.heart);
        });
      }

      animate() {
        const elapsed = this.clock.getElapsedTime();
        const positions = this.starGeo.attributes.position.array;
        for(let i=0; i<this.starVelocities.length; i++) {
            positions[i*3 + 2] += this.starVelocities[i];
            if(positions[i*3 + 2] > 5) positions[i*3 + 2] = -15;
        }
        this.starGeo.attributes.position.needsUpdate = true;
        if(this.photoGroup) this.photoGroup.rotation.y = elapsed * 0.15;
        if(this.heart) { this.heart.rotation.y = elapsed * 0.5; this.heart.scale.setScalar(0.3 + Math.sin(elapsed * 2) * 0.02); }
        this.renderer.render(this.scene, this.camera);
        requestAnimationFrame(() => this.animate());
      }

      onResize() {
        this.camera.aspect = window.innerWidth / window.innerHeight;
        this.camera.updateProjectionMatrix();
        this.renderer.setSize(window.innerWidth, window.innerHeight);
      }
    }
    new ValentineWorld();
  </script>
</body>
</html>