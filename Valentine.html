<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>I Love You - 3D Valentine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Parisienne&family=Sarabun:wght@300;600&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      overflow: hidden; 
      background: #050205; 
      color: #ffccff; 
      font-family: 'Sarabun', sans-serif; 
    }

    canvas { position: fixed; top: 0; left: 0; outline: none; }

    .content-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    h1 {
      position: absolute;
      top: 5%;
      width: 100%;
      text-align: center;
      font-family: 'Parisienne', cursive;
      font-size: clamp(2rem, 6vw, 4rem);
      text-shadow: 0 0 20px rgba(255, 102, 204, 0.9);
      animation: glow 2s ease-in-out infinite alternate;
      margin: 0;
    }

    /* กล่องข้อความล่างซ้าย (ไร้กรอบ) */
    .message-container {
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: auto;
      height: auto;
      z-index: 20;
      text-align: left;
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
    }

    .message-text {
      font-size: 1.5rem;
      font-weight: 600;
      color: #fff;
      text-shadow: 0 0 10px rgba(255, 105, 180, 0.8);
      opacity: 0;
      /* ปรับเวลา Fade ให้สมูทขึ้นเป็น 2 วินาที */
      transition: opacity 2s ease-in-out;
      position: absolute;
      bottom: 0;
      left: 0;
      white-space: nowrap;
    }

    .message-text.visible {
      opacity: 1;
    }

    @keyframes glow { 
      from { text-shadow: 0 0 15px rgba(255, 102, 204, 0.8); } 
      to { text-shadow: 0 0 25px rgba(255, 102, 204, 1), 0 0 5px #fff; } 
    }
  </style>
</head>
<body>

  <canvas class="webgl"></canvas>

  <div class="content-overlay">
    <h1>I Love You</h1>
    <div class="message-container" id="msgContainer"></div>
  </div>

  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.135.0';
    import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.135.0/examples/jsm/loaders/GLTFLoader';

    // --- ส่วนจัดการข้อความ ---
    const messages = [
      "รักเธอนะจุ๊บๆ",
      "อยากกอดจังง",
      "ตัวเล็กของเค้า",
      "คิดถึงตลอดเวลาเลย",
      "น่ารักที่สุดในโลกแล้ว",
      "ยิ้มเยอะๆนะตัวเล็ก",
      "มาอ้อนหน่อย",
      "ง้ำๆ",
      "รักๆๆๆ",
      "กินเค้าาา",
      "อยู่ในใจตลอด"
    ];

    const container = document.getElementById('msgContainer');
    let currentIndex = 0;

    function showNextMessage() {
      container.innerHTML = '';
      const p = document.createElement('p');
      p.className = 'message-text';
      p.innerText = messages[currentIndex];
      container.appendChild(p);

      // เริ่ม Fade In
      setTimeout(() => {
        p.classList.add('visible');
      }, 100);

      // *** แก้ไขเวลาตรงนี้ ***
      // 5000ms = 5 วินาที (รวมเวลา Fade In 2 วิ + โชว์เต็มๆ 3 วิ)
      setTimeout(() => {
        p.classList.remove('visible'); // เริ่ม Fade Out
        
        // รอให้จางหายไปจนหมด (2 วินาที) แล้วค่อยเปลี่ยนประโยค
        setTimeout(() => {
          currentIndex = (currentIndex + 1) % messages.length;
          showNextMessage();
        }, 2000);
        
      }, 5000); 
    }

    showNextMessage();


    // --- ส่วน 3D (เหมือนเดิม) ---
    class ValentineWorld {
      constructor() {
        this.canvas = document.querySelector('.webgl');
        this.scene = new THREE.Scene();
        this.textureLoader = new THREE.TextureLoader();
        this.clock = new THREE.Clock();
        this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        this.camera.position.z = 5;
        this.renderer = new THREE.WebGLRenderer({ canvas: this.canvas, antialias: true });
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        this.photoGroup = new THREE.Group();
        this.scene.add(this.photoGroup);
        this.init();
      }

      async init() {
        this.addMovingStars();
        this.addPhotoRing();
        await this.loadMainHeart(); 
        this.animate();
        window.addEventListener('resize', () => this.onResize());
      }

      addMovingStars() {
        const geo = new THREE.BufferGeometry();
        const count = 4000;
        const pos = new Float32Array(count * 3);
        const velocities = new Float32Array(count);
        for(let i=0; i<count*3; i++) pos[i] = (Math.random() - 0.5) * 25;
        for(let i=0; i<count; i++) velocities[i] = Math.random() * 0.03 + 0.01;
        geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        this.starVelocities = velocities;
        this.starGeo = geo;
        const mat = new THREE.PointsMaterial({ size: 0.03, color: 0xffccff, transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending });
        this.stars = new THREE.Points(geo, mat);
        this.scene.add(this.stars);
      }

      addPhotoRing() {
        const photos = ['Tong1.jpg', 'Tong2.jpg', 'Tong3.jpg', 'Tong4.jpg', 'Tong5.jpg', 'Tong6.jpg', 'Tong7.jpg', 'Tong8.jpg', 'Tong9.jpg', 'Tong10.jpg', 'Tong11.jpg'];
        const radius = 3.2;
        photos.forEach((url, i) => {
          this.textureLoader.load(url, (tex) => {
            const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });
            const mesh = new THREE.Mesh(new THREE.PlaneGeometry(0.9, 0.9), mat);
            const angle = (i / photos.length) * Math.PI * 2;
            mesh.position.set(Math.cos(angle) * radius, 0, Math.sin(angle) * radius);
            mesh.lookAt(0, 0, 0);
            mesh.rotateY(Math.PI); 
            this.photoGroup.add(mesh);
          });
        });
      }

      async loadMainHeart() {
        const loader = new GLTFLoader();
        loader.load('https://assets.codepen.io/74321/heart.glb', (gltf) => {
          this.heart = gltf.scene;
          this.heart.scale.set(0.5, 0.5, 0.5);
          this.heart.traverse(n => { if(n.isMesh) n.material = new THREE.MeshBasicMaterial({ color: 0xff3366, wireframe: true }); });
          this.scene.add(this.heart);
        });
      }

      animate() {
        const elapsed = this.clock.getElapsedTime();
        const positions = this.starGeo.attributes.position.array;
        for(let i=0; i<this.starVelocities.length; i++) {
            positions[i*3 + 2] += this.starVelocities[i];
            if(positions[i*3 + 2] > 5) positions[i*3 + 2] = -15;
        }
        this.starGeo.attributes.position.needsUpdate = true;
        if(this.photoGroup) this.photoGroup.rotation.y = elapsed * 0.15;
        if(this.heart) { this.heart.rotation.y = elapsed * 0.5; this.heart.scale.setScalar(0.5 + Math.sin(elapsed * 2) * 0.03); }
        this.renderer.render(this.scene, this.camera);
        requestAnimationFrame(() => this.animate());
      }

      onResize() {
        this.camera.aspect = window.innerWidth / window.innerHeight;
        this.camera.updateProjectionMatrix();
        this.renderer.setSize(window.innerWidth, window.innerHeight);
      }
    }
    new ValentineWorld();
  </script>
</body>
</html>
