// --- แก้ไขส่วนควบคุมให้รองรับทั้งคีย์บอร์ดและหน้าจอ ---

// 1. ฟังก์ชันเปลี่ยนทิศทาง (ตรวจสอบ window scope)
window.changeSnakeDir = (d) => { 
    if(!sRunning) return; // ถ้าเกมไม่รัน ไม่ต้องเปลี่ยนทิศทาง
    if(d=='up' && sDir!='down') sNextDir='up'; 
    if(d=='down' && sDir!='up') sNextDir='down'; 
    if(d=='left' && sDir!='right') sNextDir='left'; 
    if(d=='right' && sDir!='left') sNextDir='right'; 
};

// 2. เพิ่มตัวดักจับคีย์บอร์ด (Keyboard Listener)
document.addEventListener('keydown', (e) => {
    if(!sRunning) return;
    const key = e.key.toLowerCase(); // รองรับทั้ง W และ w
    if (key === 'w') window.changeSnakeDir('up');
    if (key === 's') window.changeSnakeDir('down');
    if (key === 'a') window.changeSnakeDir('left');
    if (key === 'd') window.changeSnakeDir('right');
    
    // ป้องกันหน้าจอเลื่อนขึ้นลงขณะเล่นเกม
    if(['w','s','a','d','arrowup','arrowdown','arrowleft','arrowright'].includes(key)) {
        e.preventDefault();
    }
});
